<html>
<head>
    <title>OpenFin Deployment Health Check</title>
    <link rel="shortcut icon" type="image/ico" href="favicon.ico">
    <link rel="stylesheet" type="text/css" href="styles.css">
    <script src="https://cdn.openfin.co/tools/deployment/1.0.0/openfin-deployment.js"></script>
    <script>
    document.addEventListener('DOMContentLoaded', async function () {
        const resultsDiv = document.getElementById('results');
        const manifestDiv = document.getElementById('manifest');
        const purl = new URL(window.location.href);
        const manifURL = purl.searchParams.get('manifest');
        const rerunBtn = document.getElementById('rerun');
        const manStat = document.getElementById('manifestStatus');
        const appStat = document.getElementById('appStatus');

        function addEndpointItem(status) {
            const li = document.createElement('li');
            li.setAttribute('id', `url_${status.id}`);
            li.classList.add(status.success ? 'good' : 'bad');
            const led = document.createElement('led');
            li.appendChild(led);
            const msg = document.createElement('span');
            msg.setAttribute('title', status.url);
            msg.innerHTML = status.displayName;
            li.appendChild(msg);
            resultsDiv.appendChild(li);
        }

        async function runIt() {
            resultsDiv.innerHTML = '';
            const endpointCheckResult = await openfinDeployment.checkEndpoints();
            endpointCheckResult.forEach((status) => addEndpointItem(status))
        }

        rerunBtn.addEventListener('click', runIt);

        runIt()
    });
    </script>
</head>
<body>
    <panel>
        <header>
            <logo></logo>
            <title>Deployment Health Check</title>
        </header>
        <content>
            <ul id="results"></ul>
            <ul id="manifest" class="noshow">
                <li id="manifestStatus" class="noshow"><led></led><span></span></li>
                <li id="appStatus" class="noshow"><led></led><span></span></li>
            </ul>    
        </content>
        <footer>
            <button id="rerun">Run Again</button>
        </footer>
    </panel>
</body>
</html>

